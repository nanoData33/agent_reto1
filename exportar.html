<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MedAI Smart Ward ‚Äî Exportar informes</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
  --azul: #1f3b73;
  --azul-sec: #3a6ff8;
  --gris-fondo: #f6f8fb;
  --gris-borde: #e0e3eb;
  --radius: 10px;
  --sombra: 0 2px 10px rgba(0,0,0,0.05);
}
body {
  font-family: "Inter", sans-serif;
  background: var(--gris-fondo);
  margin: 0;
  padding: 0;
  color: #2d2d2d;
}
header {
  background: #fff;
  padding: 14px 36px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: var(--sombra);
  position: sticky;
  top: 0;
  z-index: 10;
}
header h1 {
  font-size: 1.3rem;
  color: var(--azul);
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 8px;
}
header button {
  background: var(--azul);
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: var(--radius);
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s;
}
header button:hover { background: var(--azul-sec); }

main {
  width: 92%;
  max-width: 1100px;
  margin: 30px auto;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.card {
  background: white;
  border-radius: var(--radius);
  box-shadow: var(--sombra);
  padding: 20px;
}
.card h2 {
  color: var(--azul);
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 10px;
}
.card p {
  font-size: 0.9rem;
  color: #555;
}
.btn {
  background: var(--azul);
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: var(--radius);
  font-weight: 600;
  cursor: pointer;
  transition: 0.2s;
}
.btn:hover { background: var(--azul-sec); }

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 16px;
}
canvas { display: block; max-width: 100%; margin-top: 15px; }
@media (max-width:600px){
  header { flex-direction: column; align-items: flex-start; gap: 10px; }
}
</style>
</head>

<body>
<header>
  <h1><i class="fa-solid fa-file-medical"></i> Exportar Informes</h1>
  <button onclick="window.location='index.html'"><i class="fa-solid fa-arrow-left"></i> Volver</button>
</header>

<main>
  <section class="card">
    <h2>Panel de exportaci√≥n</h2>
    <p id="rolInfo">Cargando permisos...</p>
  </section>

  <div id="exportGrid" class="grid"></div>
</main>

<script>
// ==== Simulaci√≥n del usuario ====
const usuario = JSON.parse(localStorage.getItem("usuario")) || {
  Nombre: "Dr. Mart√≠nez",
  Rol: "M√©dico",
  Especialidad: "Medicina Interna"
};

// ==== Definir permisos y secciones ====
const secciones = {
  "M√©dico": [
    { titulo: "Informe evolutivo del paciente", desc: "Evoluci√≥n cl√≠nica y resumen IA", accion: generarInformeEvolutivo },
    { titulo: "Informe de laboratorio", desc: "Resultados recientes de anal√≠ticas", accion: generarInformeLaboratorio }
  ],
  "Enfermero": [
    { titulo: "Control de signos vitales", desc: "Tendencia de constantes vitales", accion: generarSignosVitales },
    { titulo: "Registro de medicaciones", desc: "Listado de administraci√≥n diaria", accion: generarMedicaciones }
  ],
  "Administrador": [
    { titulo: "Resumen global del hospital", desc: "Ocupaci√≥n, medias cl√≠nicas y actividad", accion: generarInformeGlobal },
    { titulo: "Informe de personal", desc: "Resumen por departamento y rol", accion: generarInformePersonal }
  ]
};

// ==== Render din√°mico seg√∫n rol ====
document.getElementById("rolInfo").innerHTML = `${usuario.Nombre} ‚Äî ${usuario.Rol}${usuario.Especialidad ? " ¬∑ " + usuario.Especialidad : ""}`;

const grid = document.getElementById("exportGrid");
(secciones[usuario.Rol] || []).forEach(sec => {
  const div = document.createElement("div");
  div.className = "card";
  div.innerHTML = `
    <h2>${sec.titulo}</h2>
    <p>${sec.desc}</p>
    <button class="btn" onclick="(${sec.accion.toString()})();">Generar PDF</button>
  `;
  grid.appendChild(div);
});

// ==== Funciones de generaci√≥n de PDFs ====
function generarInformeEvolutivo() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const nombre = "Juan P√©rez";
  const fecha = new Date().toLocaleDateString();

  doc.setFontSize(16);
  doc.text("üìã Informe Evolutivo del Paciente", 14, 20);
  doc.setFontSize(11);
  doc.text(`Paciente: ${nombre}`, 14, 30);
  doc.text(`Fecha: ${fecha}`, 14, 37);
  doc.text("Servicio: Medicina Interna", 14, 44);

  doc.text("Resumen IA:", 14, 56);
  doc.setFont("helvetica", "normal");
  doc.text("El paciente presenta mejor√≠a respiratoria progresiva, con descenso sostenido de la glucemia y estabilidad hemodin√°mica.", 14, 63, { maxWidth: 180, lineHeightFactor: 1.4 });
  
  doc.text("Gr√°fico de evoluci√≥n de glucosa:", 14, 90);
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  new Chart(ctx, {
    type: "line",
    data: {
      labels: ["D√≠a 1","D√≠a 2","D√≠a 3","D√≠a 4","D√≠a 5"],
      datasets: [{ label:"Glucosa (mg/dL)", data:[180,160,150,130,115], borderColor:"#1f3b73", fill:false }]
    },
    options:{ responsive:false, animation:false }
  });
  setTimeout(()=> {
    const img = canvas.toDataURL("image/png");
    doc.addImage(img, "PNG", 14, 95, 180, 60);
    doc.save(`Informe_Evolutivo_${nombre}.pdf`);
  }, 400);
}

function generarInformeLaboratorio(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("üß™ Informe de Laboratorio", 14, 20);
  doc.setFontSize(11);
  doc.text("Paciente: Laura G√≥mez", 14, 30);
  doc.text("√öltimos valores:", 14, 40);
  doc.autoTable({
    startY: 45,
    head:[["Par√°metro","Valor","Unidad"]],
    body:[
      ["Glucosa","102","mg/dL"],
      ["Hemoglobina","13.5","g/dL"],
      ["Creatinina","0.9","mg/dL"],
      ["Colesterol Total","175","mg/dL"]
    ]
  });
  doc.save("Informe_Laboratorio_LauraGomez.pdf");
}

function generarSignosVitales(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("üìä Control de signos vitales", 14, 20);
  doc.autoTable({
    startY: 30,
    head:[["Fecha","TA (mmHg)","FC (lpm)","Temp (¬∞C)","SatO‚ÇÇ (%)"]],
    body:[
      ["2025-10-25","120/75","78","36.8","98"],
      ["2025-10-26","118/72","75","36.7","98"],
      ["2025-10-27","122/76","79","37.0","97"]
    ]
  });
  doc.save("SignosVitales_Paciente.pdf");
}

function generarMedicaciones(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("üíä Registro de Medicaciones", 14, 20);
  doc.autoTable({
    startY: 30,
    head:[["Medicamento","Dosis","V√≠a","Hora"]],
    body:[
      ["Paracetamol","1g","VO","08:00"],
      ["Metformina","850mg","VO","09:00"],
      ["Furosemida","40mg","IV","18:00"]
    ]
  });
  doc.save("Medicaciones_Paciente.pdf");
}

function generarInformeGlobal(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("üè• Informe Global del Hospital", 14, 20);
  doc.setFontSize(11);
  doc.text("Ocupaci√≥n actual: 85%", 14, 30);
  doc.text("Pacientes activos: 126", 14, 36);
  doc.text("Media de estancia: 4.2 d√≠as", 14, 42);
  doc.text("Tasa de reingreso: 7%", 14, 48);
  doc.text("Resumen IA:", 14, 60);
  doc.text("El nivel asistencial se mantiene estable con carga moderada de hospitalizaci√≥n y sin incremento de urgencias graves.", 14, 67, { maxWidth: 180 });
  doc.save("Informe_Global_Hospital.pdf");
}

function generarInformePersonal(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("üë• Informe de Personal M√©dico", 14, 20);
  doc.autoTable({
    startY: 30,
    head:[["Nombre","Rol","Especialidad","Activo"]],
    body:[
      ["Dr. L√≥pez","M√©dico","Cardiolog√≠a","S√≠"],
      ["Dra. Torres","Residente","Medicina Interna","S√≠"],
      ["D. P√©rez","Enfermero","UCI","S√≠"],
      ["Dra. Ruiz","Supervisora","Rehabilitaci√≥n","S√≠"]
    ]
  });
  doc.save("Informe_Personal_Hospital.pdf");
}
</script>
</body>
</html>
