<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MedAI Evolution Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f2f4f5;
  --card: #ffffff;
  --text: #1b1f23;
  --primary: #1d3557;
  --accent: #219ebc;
  --border: #c5ccd1;
  --stable: #16a34a;
  --warning: #facc15;
  --critical: #dc2626;
}
body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background: var(--bg);
  color: var(--text);
}
header {
  background: linear-gradient(90deg, var(--primary), var(--accent));
  color: white;
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 14px rgba(0,0,0,0.25);
}
.brand {
  display: flex;
  align-items: center;
  gap: 0.8rem;
}
.brand img { width: 42px; height: 42px; }
main {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: calc(100vh - 90px);
}
.floor {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 1.2rem;
  padding: 2rem;
  max-width: 1000px;
}
.room {
  width: 180px;
  height: 110px;
  background: var(--card);
  border: 2px solid var(--border);
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: all 0.25s ease;
}
.room:hover {
  transform: scale(1.05);
  border-color: var(--accent);
}
.status {
  margin-top: 6px;
  font-size: 0.7rem;
  padding: 0.25rem 0.6rem;
  border-radius: 6px;
  color: white;
  font-weight: 600;
}
.stable { background: var(--stable); }
.warning { background: var(--warning); color: #222; }
.critical { background: var(--critical); }
.popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  background: var(--card);
  width: 520px;
  border-radius: 14px;
  box-shadow: 0 15px 45px rgba(0,0,0,0.35);
  padding: 1.5rem 1.8rem;
  display: none;
  flex-direction: column;
  transition: all 0.25s ease;
  z-index: 200;
}
.popup.active { display: flex; transform: translate(-50%, -50%) scale(1); }
.tabs { display: flex; gap: 0.5rem; margin: 1rem 0; flex-wrap: wrap; }
.tab {
  background: #e5ebed;
  border: none;
  border-radius: 8px;
  padding: 0.45rem 0.9rem;
  cursor: pointer;
  font-weight: 500;
}
.tab:hover, .tab.active { background: var(--accent); color: white; }
.content {
  background: #f7f9fa;
  border-radius: 10px;
  padding: 1rem;
  font-size: 0.85rem;
  box-shadow: inset 0 0 6px rgba(0,0,0,0.05);
  min-height: 180px;
  max-height: 320px;
  overflow-y: auto;
}
button {
  border: none;
  border-radius: 8px;
  padding: 0.5rem 0.8rem;
  margin-top: 1rem;
  font-weight: 600;
  cursor: pointer;
}
.ai-btn { background: var(--primary); color: white; }
.ai-btn:hover { background: var(--accent); }
.close-btn { background: var(--critical); color: white; align-self: flex-end; }
.close-btn:hover { background: #a31d1d; }
</style>
</head>
<body>
<header>
  <div class="brand">
    <img src="https://cdn-icons-png.flaticon.com/512/2966/2966327.png" alt="MedAI Logo">
    <h1>MedAI Evolution Assistant</h1>
  </div>
</header>

<main>
  <div class="floor" id="floor"></div>
</main>

<div class="popup" id="popup">
  <h2 id="popup-name"></h2>
  <div class="tabs">
    <button class="tab active" onclick="setTab('info')">Datos</button>
    <button class="tab" onclick="setTab('trat')">Tratamientos</button>
    <button class="tab" onclick="setTab('res')">Resultados</button>
    <button class="tab" onclick="setTab('evol')">Evolución</button>
    <button class="tab" onclick="setTab('alta')">Alta</button>
  </div>
  <div class="content" id="popup-content"></div>
  <button class="ai-btn" onclick="showPrediction()">Análisis Predictivo IA</button>
  <button class="close-btn" onclick="closePopup()">Cerrar</button>
</div>

<script>
let pacientes = [];
let currentPatient = null;

window.addEventListener("DOMContentLoaded", async () => {
  try {
    const res = await fetch("pacientes_completo.json");
    pacientes = await res.json();

    const floor = document.getElementById("floor");
    floor.innerHTML = pacientes.map(p => `
      <div class="room" onclick="openPopup('${p.paciente.nombre}')">
        <h3>${p.paciente.nombre}</h3>
        <div class="status stable">Paciente</div>
      </div>
    `).join("");
  } catch (err) {
    console.error("Error cargando JSON:", err);
  }
});

function openPopup(nombre) {
  const popup = document.getElementById('popup');
  const popupName = document.getElementById('popup-name');
  popupName.textContent = nombre;
  popup.classList.add('active');
  currentPatient = pacientes.find(p => (p.paciente.nombre || "").toLowerCase() === nombre.toLowerCase());
  setTab('info');
}

function closePopup() {
  document.getElementById('popup').classList.remove('active');
}

function setTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  const c = document.getElementById('popup-content');
  if (!currentPatient) {
    c.innerHTML = "<i>No hay datos.</i>";
    return;
  }

  if (tab === 'info') {
    const p = currentPatient.paciente;
    c.innerHTML = `
      <b>Edad:</b> ${p.edad || "-"}<br>
      <b>Sexo:</b> ${p.sexo || "-"}<br>
      <b>Peso:</b> ${p.peso_kg || "-"} kg<br>
      <b>Altura:</b> ${p.altura_cm || "-"} cm<br>
      <b>IMC:</b> ${p.imc || "-"}<br>
      <b>Motivo ingreso:</b> ${p.motivo_ingreso || "-"}<br>
      <b>Fecha ingreso:</b> ${p.fecha_ingreso || "-"}<br>
      <b>Servicio:</b> ${p.servicio || "-"}<br>
      <b>Nivel dependencia:</b> ${p.nivel_dependencia || "-"}<br>
      <b>Riesgo caídas:</b> ${p.riesgo_caidas ? "Sí" : "No"}
    `;
  }

  else if (tab === 'trat') {
    const t = currentPatient.tratamientos;
    c.innerHTML = t?.length ? t.map(x => `
      <b>Día ${x.dia_estancia}</b>: ${x.tratamiento}<br>
      Vía: ${x.via_administracion || "-"}<br>
      ${x.cambio_tratamiento ? `Cambio: ${x.cambio_tratamiento}<br>` : ""}
      ${x.procedimientos ? `Procedimientos: ${x.procedimientos}<br>` : ""}
      ${x.efectos_secundarios ? `Efectos: ${x.efectos_secundarios}<br>` : ""}
      <hr>
    `).join("") : "<i>No hay tratamientos.</i>";
  }

  else if (tab === 'res') {
    const r = currentPatient.resultados_clinicos;
    c.innerHTML = r?.length ? r.map(x => `
      <b>${x.fecha}</b> - ${x.estado_general || ""}<br>
      Temp: ${x.temperatura || "-"} °C, FC: ${x.frecuencia_cardiaca || "-"} bpm, O₂: ${x.spo2 || "-"}%<br>
      ${x.presion_arterial ? "PA: "+x.presion_arterial+"<br>" : ""}
      ${x.observaciones ? "<i>"+x.observaciones+"</i><br>" : ""}
      <hr>
    `).join("") : "<i>No hay resultados clínicos.</i>";
  }

  else if (tab === 'evol') {
    const e = currentPatient.evolucion_medica;
    c.innerHTML = e?.length ? e.map(x => `
      <b>${x.fecha}</b> - ${x.firma_medico || ""}<br>${x.nota_medica || ""}<hr>
    `).join("") : "<i>Sin evolución médica.</i>";
  }

  else if (tab === 'alta') {
    const a = currentPatient.alta_resumen;
    c.innerHTML = a?.length ? a.map(x => `
      <b>Fecha alta:</b> ${x.fecha_alta || "-"}<br>
      <b>Diagnóstico principal:</b> ${x.diagnostico_principal || "-"}<br>
      <b>Secundarios:</b> ${x.diagnosticos_secundarios || "-"}<br>
      <b>Evolución:</b> ${x.evolucion_resumen || "-"}<br>
      <b>Tratamiento al alta:</b> ${x.tratamiento_alta || "-"}<br>
      <b>Seguimiento:</b> ${x.seguimiento_recomendado || "-"}<br>
      <b>Riesgo recaída:</b> ${x.riesgo_recaida_estimado || "-"}%<br>
      <b>Modelo generador:</b> ${x.modelo_generador || "-"}<hr>
    `).join("") : "<i>Sin informe de alta.</i>";
  }
}

function showPrediction() {
  const c = document.getElementById('popup-content');
  c.innerHTML += `<br><b>Predicción IA:</b> Paciente con evolución estable.`;
}
</script>
</body>
</html>
