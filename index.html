<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MedAI Evolution Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
body { margin: 0; font-family: "Inter", sans-serif; background: #f5f7f9; color: #1b1f23; }
header {
  background: linear-gradient(90deg, #1d3557, #219ebc);
  color: white; padding: 1rem 2rem;
  display: flex; align-items: center; gap: 0.8rem;
  box-shadow: 0 4px 14px rgba(0,0,0,0.25);
}
header img { width: 42px; height: 42px; }
main { display: flex; justify-content: center; align-items: flex-start; padding: 2rem; flex-wrap: wrap; gap: 1.2rem; }
.card {
  background: white; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  width: 200px; padding: 1rem; cursor: pointer; transition: 0.3s;
}
.card:hover { transform: scale(1.05); border: 1px solid #219ebc; }
.popup {
  position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
  background: white; padding: 1.5rem; border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3); width: 90%; max-width: 400px;
  display: none; z-index: 999;
}
.popup.active { display: block; }
.popup h2 { margin-top: 0; color: #1d3557; }
.close-btn {
  background: #dc2626; color: white; border: none; padding: 0.5rem 0.8rem;
  border-radius: 6px; font-weight: 600; cursor: pointer;
}
.close-btn:hover { background: #b91c1c; }
</style>
</head>
<body>

<header>
  <img src="https://cdn-icons-png.flaticon.com/512/2966/2966327.png" alt="MedAI Logo">
  <h1>MedAI Evolution Assistant</h1>
</header>

<main id="hall"></main>

<div class="popup" id="popup">
  <h2 id="popup-name"></h2>
  <p><b>Edad:</b> <span id="popup-edad"></span></p>
  <p><b>Sexo:</b> <span id="popup-sexo"></span></p>
  <p><b>Motivo ingreso:</b> <span id="popup-motivo"></span></p>
  <p><b>Comorbilidades:</b> <span id="popup-comor"></span></p>
  <p><b>Alergias:</b> <span id="popup-alerg"></span></p>
  <button class="close-btn" onclick="closePopup()">Cerrar</button>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = "https://aczjgeleupwlvghjhkav.supabase.co";
const anonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFjempnZWxldXB3bHZnaGpoa2F2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5NzgwODMsImV4cCI6MjA3NjU1NDA4M30.-hQdLNDMw-i4vCpt_OXnzYss5MtVrCu76FhMCPcZPhM";
const supabase = window.supabase.createClient(supabaseUrl, anonKey);

async function loadPatients() {
  const { data, error } = await supabase.from("vista_pacientes_completo").select("*");
  if (error) {
    console.error(error);
    document.getElementById("hall").innerHTML = "<p>Error al cargar pacientes.</p>";
    return;
  }
  const hall = document.getElementById("hall");
  hall.innerHTML = data.map(p => `
    <div class="card" onclick="showDetails('${p.patient_id}')">
      <h3>${p.nombre}</h3>
      <p><b>Edad:</b> ${p.edad}</p>
      <p><b>Sexo:</b> ${p.sexo}</p>
    </div>
  `).join("");
  window.pacientes = data;
}

function showDetails(id) {
  const p = window.pacientes.find(x => x.patient_id === id);
  if (!p) return;
  document.getElementById("popup-name").textContent = p.nombre;
  document.getElementById("popup-edad").textContent = p.edad || "-";
  document.getElementById("popup-sexo").textContent = p.sexo || "-";
  document.getElementById("popup-motivo").textContent = p.motivo_ingreso || "-";
  document.getElementById("popup-comor").textContent = p.comorbilidades || "-";
  document.getElementById("popup-alerg").textContent = p.alergias || "-";
  document.getElementById("popup").classList.add("active");
}

function closePopup() {
  document.getElementById("popup").classList.remove("active");
}

loadPatients();
</script>

</body>
</html>
