<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MedAI Evolution Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2966/2966327.png">
<style>
/* === Colores y estilos base === */
:root {
  --bg: #f2f4f5;
  --corridor: #cdd4d8;
  --card: #ffffff;
  --text: #1b1f23;
  --primary: #1d3557;
  --accent: #219ebc;
  --stable: #16a34a;
  --warning: #facc15;
  --critical: #dc2626;
  --border: #c5ccd1;
  --dark: #0f172a;
}

body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background: var(--bg);
  color: var(--text);
  overflow-x: hidden;
}

/* === Header === */
header {
  background: linear-gradient(90deg, var(--dark), var(--primary));
  color: white;
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 14px rgba(0,0,0,0.25);
}

.brand { display: flex; align-items: center; gap: 0.8rem; }
.brand img { width: 42px; height: 42px; filter: drop-shadow(0 0 4px rgba(255,255,255,0.3)); }
.brand h1 { margin: 0; font-size: 1.4rem; font-weight: 600; }

.chat-trigger {
  background: var(--accent); color: white; border: none; border-radius: 8px;
  padding: 0.45rem 1rem; font-weight: 500; cursor: pointer;
  transition: background 0.25s; box-shadow: 0 3px 10px rgba(0,0,0,0.25);
}
.chat-trigger:hover { background: #0284c7; }

/* === Estructura principal === */
main {
  display: flex;
  justify-content: center;
  align-items: center;
  height: calc(100vh - 90px);
  position: relative;
}
.floor {
  width: 94%;
  height: 520px;
  position: relative;
}
.corridor {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 95%; height: 120px;
  background: linear-gradient(90deg, #d9dee2, #b8c0c7);
  border-radius: 45px; border: 4px solid var(--border);
  box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
}
.rooms { position: absolute; width: 100%; display: flex; justify-content: space-evenly; z-index: 5; }
.rooms.top { top: 60px; } .rooms.bottom { bottom: 60px; }

.room {
  width: 145px; height: 95px; background: var(--card);
  border: 2px solid var(--border); border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  cursor: pointer; transition: all 0.25s ease;
  opacity: 0; transform: translateY(20px); animation: fadeIn 0.7s ease forwards;
}
@keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
.room:hover { transform: scale(1.05); border-color: var(--accent); }
.room h3 { margin: 0; font-size: 0.85rem; font-weight: 600; color: var(--primary); }

.status {
  margin-top: 6px; font-size: 0.7rem; padding: 0.25rem 0.6rem;
  border-radius: 6px; color: white; font-weight: 600;
}
.stable { background: var(--stable); }
.warning { background: var(--warning); color: #222; }
.critical { background: var(--critical); }

/* === Popup paciente === */
.popup {
  position: fixed; top: 50%; left: 50%;
  transform: translate(-50%, -50%) scale(0.9);
  background: var(--card); width: 480px; border-radius: 14px;
  box-shadow: 0 15px 45px rgba(0,0,0,0.35);
  padding: 1.5rem 1.8rem; display: none; flex-direction: column;
  z-index: 200; transition: all 0.25s ease;
}
.popup.active { display: flex; transform: translate(-50%, -50%) scale(1); }
.tabs { display: flex; gap: 0.5rem; margin: 1rem 0; }
.tab { background: #e5ebed; border: none; border-radius: 8px; padding: 0.45rem 0.9rem; cursor: pointer; }
.tab:hover, .tab.active { background: var(--accent); color: white; }
.content { background: #f7f9fa; border-radius: 10px; padding: 1rem; font-size: 0.85rem; }
.close-btn, .ai-btn { border: none; border-radius: 8px; padding: 0.5rem 0.8rem; margin-top: 1rem; font-weight: 600; cursor: pointer; }
.ai-btn { background: var(--primary); color: white; } .ai-btn:hover { background: var(--accent); }
.close-btn { background: var(--critical); color: white; align-self: flex-end; } .close-btn:hover { background: #a31d1d; }

/* === Chat === */
.chat-modal {
  position: fixed; right: -380px; top: 0; height: 100%; width: 360px;
  background: #ffffff; box-shadow: -4px 0 20px rgba(0,0,0,0.25);
  border-left: 4px solid var(--accent); transition: right 0.4s ease;
  z-index: 300; display: flex; flex-direction: column;
}
.chat-modal.active { right: 0; }
.chat-header { background: var(--primary); color: white; padding: 1rem; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
.chat-body { flex: 1; padding: 1rem; background: #f8f9fa; overflow-y: auto; font-size: 0.9rem; display: flex; flex-direction: column; }
.chat-body p { padding: 0.6rem 0.8rem; border-radius: 8px; margin: 0.5rem 0; max-width: 80%; }
.chat-body p.ai { background: #dbeef5; align-self: flex-start; }
.chat-body p.user { background: #c8e0e8; align-self: flex-end; }
.chat-input { display: flex; border-top: 1px solid #ddd; padding: 0.6rem; background: white; gap: 0.5rem; }
.chat-input input { flex: 1; border: none; outline: none; padding: 0.4rem; }
.chat-input button { background: var(--accent); border: none; border-radius: 8px; color: white; padding: 0.45rem 0.7rem; cursor: pointer; }
.mic-btn { background: var(--primary); }
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="https://cdn-icons-png.flaticon.com/512/2966/2966327.png" alt="MedAI Logo">
    <h1>MedAI Evolution Assistant</h1>
  </div>
  <button class="chat-trigger" onclick="toggleChat()">Asistente IA</button>
</header>

<main>
  <div class="floor">
    <div class="rooms top" id="rooms-top"></div>
    <div class="corridor"></div>
    <div class="rooms bottom" id="rooms-bottom"></div>
  </div>
</main>

<!-- Popup -->
<div class="popup" id="popup">
  <h2 id="popup-name"></h2>
  <div class="tabs">
    <button class="tab active" onclick="setTab('med')">Medicaci√≥n</button>
    <button class="tab" onclick="setTab('tests')">Resultados</button>
    <button class="tab" onclick="setTab('report')">Informe</button>
  </div>
  <div class="content" id="popup-content"></div>
  <button class="ai-btn" onclick="showPrediction()">An√°lisis Predictivo IA</button>
  <button class="close-btn" onclick="closePopup()">Cerrar</button>
</div>

<!-- Chat -->
<div class="chat-modal" id="chat">
  <div class="chat-header">MedAI Assistant<button onclick="toggleChat()">√ó</button></div>
  <div class="chat-body" id="chat-body">
    <p class="ai">Hola, soy MedAI. Puedo generar res√∫menes evolutivos o analizar evoluci√≥n por voz.</p>
  </div>
  <div class="chat-input">
    <button class="mic-btn">üéôÔ∏è</button>
    <input type="text" id="chat-input" placeholder="Escribe o graba tu consulta...">
    <button onclick="sendMessage()">Enviar</button>
  </div>
</div>

<script>
const popup = document.getElementById('popup');
const popupName = document.getElementById('popup-name');
const popupContent = document.getElementById('popup-content');
let pacientes = [];

window.addEventListener("DOMContentLoaded", async () => {
  const res = await fetch("pacientes_completo.json");
  pacientes = await res.json();
  loadRooms();
});

function loadRooms() {
  const top = document.getElementById("rooms-top");
  const bottom = document.getElementById("rooms-bottom");
  const mitad = Math.ceil(pacientes.length / 2);
  pacientes.slice(0, mitad).forEach(p => top.innerHTML += `<div class='room' onclick="openPopup('${p.nombre}')"><h3>${p.habitacion}</h3><div class='status ${p.estado.toLowerCase()}'>${p.estado}</div></div>`);
  pacientes.slice(mitad).forEach(p => bottom.innerHTML += `<div class='room' onclick="openPopup('${p.nombre}')"><h3>${p.habitacion}</h3><div class='status ${p.estado.toLowerCase()}'>${p.estado}</div></div>`);
}

let currentPatient;
function openPopup(nombre) {
  popup.classList.add("active");
  currentPatient = pacientes.find(p => p.nombre === nombre);
  popupName.textContent = nombre;
  popupContent.innerHTML = renderMedicacion();
}
function closePopup() { popup.classList.remove("active"); }

function setTab(tab) {
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  event.target.classList.add("active");
  if (tab === "med") popupContent.innerHTML = renderMedicacion();
  else if (tab === "tests") popupContent.innerHTML = renderResultados();
  else popupContent.innerHTML = renderInforme();
}

function renderMedicacion() {
  return currentPatient?.tratamientos?.length
    ? `<b>Tratamiento actual:</b><br>${currentPatient.tratamientos.map(t => "‚Ä¢ " + t.tratamiento).join("<br>")}`
    : "<i>No hay tratamientos registrados.</i>";
}

function renderResultados() {
  const ult = currentPatient?.resultados_clinicos?.slice(-1)[0];
  if (!ult) return "<i>No hay resultados disponibles.</i>";
  return `<b>√öltimos resultados:</b><br>Temperatura: ${ult.temperatura} ¬∞C<br>Frecuencia card√≠aca: ${ult.frecuencia_cardiaca} bpm`;
}

function renderInforme() {
  const info = currentPatient?.alta_resumen?.slice(-1)[0];
  return info
    ? `<b>Informe cl√≠nico:</b><br>${info.evolucion_resumen}`
    : "<i>No hay informe disponible.</i>";
}

function showPrediction() {
  popupContent.innerHTML = `<b>Predicci√≥n IA:</b><br>Alta estimada en ${(Math.random()*3+1).toFixed(1)} d√≠as.`;
}

function toggleChat() { document.getElementById("chat").classList.toggle("active"); }
function sendMessage() {
  const val = document.getElementById("chat-input").value;
  if (val) {
    const body = document.getElementById("chat-body");
    body.innerHTML += `<p class='user'>${val}</p><p class='ai'>Procesando...</p>`;
  }
}
</script>
</body>
</html>
